#!/bin/sh
# Wrapper around xulrunner/firefox to start the xulrunner application conkeror
# Written by Axel Beckert <abe@deuxchevaux.org> for the Debian Project

# Find an appropriate xulrunner binary
XULRUNNER=''
for xr in xulrunner-8.0 xulrunner-7.0 xulrunner-6.0 xulrunner-5.0 xulrunner-2.0 xulrunner-1.9.2 xulrunner-1.9.1 xulrunner; do
    XRTMP=`which $xr`
    if [ -n "$XRTMP" -a -x "$XRTMP" ]; then
	if expr `$XRTMP --gre-version | cut -d . -f 1,2,3` '>=' 1.9.1 > /dev/null; then
	    # xulrunner is version 1.9 or higher, take it
	    XULRUNNER=$XRTMP
	    break
	else
	    # xulrunner is older than version 1.9, forget it
	    XRTMP=/usr/lib/$xr/xulrunner
	    if [ -x $XRTMP ]; then
		if expr `$XRTMP --gre-version | cut -d . -f 1,2,3` '>=' 1.9.1 > /dev/null; then
		    # xulrunner is a 1.9 version, take it
		    XULRUNNER=$XRTMP
		    break
		fi
	    fi
	fi
    fi
done

# Try firefox if no xulrunner can be found
if [ -z "$XULRUNNER" ]; then
    FFTMP=`which firefox`
    if [ -n "$FFTMP" -a -x "$FFTMP" ]; then
	echo "xulrunner not found, trying firefox instead." 1>&2
	XULRUNNER="$FFTMP -app"
    fi
fi

if [ -z "$XULRUNNER" ]; then
    echo "xulrunner version 1.9.1 (or firefox version 3.5) or newer required, but not found. Bailing out." 1>&2
    exit 1;
fi

if [ "$*" = "--help" ]; then
    errormsg="`exec $XULRUNNER /usr/share/conkeror/application.ini \"$@\" 2>&1`"
    echo "$errormsg" | sed -e "s:/[^ ]*/xulrunner-bin:$0:; /-\(width\|height\)/d" 1>&2
else
    exec $XULRUNNER /usr/share/conkeror/application.ini "$@"
fi
