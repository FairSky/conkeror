<?xml version="1.0"?>

<bindings xmlns="http://www.mozilla.org/xbl"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:xbl="http://www.mozilla.org/xbl">

<binding id="conkframe">
      <content>
          <xul:deck flex="1">
            <xul:vbox flex="1">
	      <xul:browser flex="1" type="content-primary" pile="0"/>
	      <xul:hbox class="mode-line">
	      <xul:label class="mode-line-label" value="" crop="right" flex="1"/>
              </xul:hbox>
	    </xul:vbox>
	  </xul:deck>
      </content>
      <implementation type="application/x-javascript" implements="nsIDOMXULSelectControlElement">
            <field name="mCurrentWindow">
	          null
	    </field>
            <field name="mCurrentBrowser">
	          null
	    </field>
	    <field name="mBrowserContainer">
	      document.getAnonymousNodes(this)[0]
            </field>
	    <field name="mProgressListener">
	      null
            </field>
	    <field name="mProgressFilter">
	      null
            </field>

      <property name="mBrowsers"
                onget="return this.mBrowserContainer.getElementsByTagNameNS('http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul', 'browser');"
                readonly="true"/>

      <method name="setBrowserProgressListener">
        <parameter name="aBrowser"/>
        <body>
          <![CDATA[
	  try {
            aBrowser.webProgress.addProgressListener(this.mProgressFilter, Components.interfaces.nsIWebProgress.NOTIFY_ALL);
} catch(e) {window.alert(e);}
          ]]>
        </body>
      </method>

      <method name="getBrowserAtIndex">
        <parameter name="aIndex"/>
        <body>
          <![CDATA[
            return this.mBrowsers[aIndex];
          ]]>
        </body>
      </method>

      <property name="modeLine"
                onget="return this.mCurrentBrowser.nextSibling.firstChild"
		readonly="true"/>
      <property name="docShell"
                onget="return this.mCurrentBrowser.docShell"
                readonly="true"/>

      <property name="webNavigation"
                onget="return this.mCurrentBrowser.webNavigation"
                readonly="true"/>

      <property name="webProgress"
                readonly="true"
                onget="return this.mCurrentBrowser.webProgress"/>

      <property name="markupDocumentViewer"
                onget="return this.mCurrentBrowser.markupDocumentViewer;"
                readonly="true"/>

      <property name="contentDocument"
                onget="return this.mCurrentBrowser.contentDocument;"
                readonly="true"/>
      <property name="curbrow"
                onget="return this.mBrowserContainer;"
                readonly="true"/>

      <property name="browsers"
                onget="return this.mBrowserContainer.getElementsByTagNameNS('http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul', 'browser');"
                readonly="true"/>

      <constructor>
        <![CDATA[
	  this.mCurrentBrowser = this.getBrowserAtIndex(0);
	  this.mProgressFilter = Components.classes["@mozilla.org/appshell/component/browser-status-filter;1"]
                                           .createInstance(Components.interfaces.nsIWebProgress);
          this.setBrowserProgressListener(this.mCurrentBrowser);
        ]]>
      </constructor>
      </implementation>
</binding>
</bindings>
